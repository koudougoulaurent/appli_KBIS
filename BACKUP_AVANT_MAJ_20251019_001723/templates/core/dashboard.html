{% extends 'base.html' %}
{% load static %}

{% block title %}GESTION IMMOBILIERE PRO - Gestion Immobilière{% endblock %}

{% block content %}
<div class="container-fluid" id="main-dashboard">
    <!-- En-tête du dashboard -->
    <div class="dashboard-header" role="banner">
        <div class="row align-items-center">
            <div class="col-12">
                <h1 class="h2 mb-2">
                    <i class="bi bi-speedometer2 me-3" aria-hidden="true"></i> GESTION IMMOBILIERE PRO
                </h1>
                <p class="mb-0 opacity-75">Vue d'ensemble de votre gestion immobilière</p>
            </div>
        </div>
    </div>

    <!-- Cartes de statistiques -->
    <div class="row" role="region" aria-label="Statistiques">
        <!-- Utilisateurs -->
        <div class="col-xl-3 col-md-6">
            <div class="stat-card primary" role="region" aria-labelledby="utilisateurs-label">
                <div class="card-body text-center">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-start">
                            <div class="stat-number" id="total-paiements">{{ total_users }}</div>
                            <div class="stat-label" id="utilisateurs-label">Utilisateurs</div>
                            <div class="stat-subtitle"><span id="paiements-valides">{{ active_users }}</span> actifs</div>
                        </div>
                        <div class="stat-icon">
                            <i class="bi bi-people" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Propriétés -->
        <div class="col-xl-3 col-md-6">
            <div class="stat-card success" role="region" aria-labelledby="proprietes-label">
                <div class="card-body text-center">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-start">
                            <div class="stat-number" id="total-proprietes">{{ total_proprietes }}</div>
                            <div class="stat-label" id="proprietes-label">Propriétés</div>
                            <div class="stat-subtitle"><span id="proprietes-louees">{{ proprietes_disponibles }}</span> disponibles</div>
                        </div>
                        <div class="stat-icon">
                            <i class="bi bi-house" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bailleurs -->
        <div class="col-xl-3 col-md-6">
            <div class="stat-card danger" role="region" aria-labelledby="bailleurs-label">
                <div class="card-body text-center">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-start">
                            <div class="stat-number" id="total-bailleurs">{{ total_bailleurs }}</div>
                            <div class="stat-label" id="bailleurs-label">Bailleurs</div>
                            <div class="stat-subtitle">Propriétaires</div>
                        </div>
                        <div class="stat-icon">
                            <i class="bi bi-person-badge" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Locataires -->
        <div class="col-xl-3 col-md-6">
            <div class="stat-card warning" role="region" aria-labelledby="locataires-label">
                <div class="card-body text-center">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-start">
                            <div class="stat-number" id="total-locataires">{{ total_locataires }}</div>
                            <div class="stat-label" id="locataires-label">Locataires</div>
                            <div class="stat-subtitle">Actifs</div>
                        </div>
                        <div class="stat-icon">
                            <i class="bi bi-person-check" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Reçus -->
        <div class="col-xl-3 col-md-6">
            <div class="stat-card info" role="region" aria-labelledby="recus-label">
                <div class="card-body text-center">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-start">
                            <div class="stat-number" id="total-recus">{{ total_recus }}</div>
                            <div class="stat-label" id="recus-label">Reçus</div>
                            <div class="stat-subtitle">
                                <span id="recus-valides">{{ recus_valides }}</span> valides,
                                <span id="recus-imprimes">{{ recus_imprimes }}</span> imprimés
                            </div>
                        </div>
                        <div class="stat-icon">
                            <i class="bi bi-receipt" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Montant total des reçus -->
        <div class="col-xl-3 col-md-6">
            <div class="stat-card secondary" role="region" aria-labelledby="montant-recus-label">
                <div class="card-body text-center">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-start">
                            <div class="stat-number" id="montant-total-recus">{{ montant_total_recus }} F CFA</div>
                            <div class="stat-label" id="montant-recus-label">Montant Total Reçus</div>
                            <div class="stat-subtitle">Tous reçus confondus</div>
                        </div>
                        <div class="stat-icon">
                            <i class="bi bi-currency-exchange" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section Unités Locatives -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-primary" style="background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-building"></i> Gestion des Unités Locatives
                        </h5>
                        <span class="badge bg-light text-primary">NOUVEAU</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h6 class="text-primary mb-3">Système Avancé pour Grandes Propriétés</h6>
                            <p class="mb-3">
                                Gérez efficacement vos immeubles avec de nombreuses unités locatives : 
                                appartements, bureaux, chambres, locaux commerciaux, etc.
                            </p>
                            <div class="row mb-3">
                                <div class="col-sm-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <small>Tableaux de bord spécialisés</small>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <small>Système de réservation</small>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <small>Gestion par étage</small>
                                    </div>
                                    <div class="d-flex align-items-center mb-2">
                                        <i class="fas fa-check-circle text-success me-2"></i>
                                        <small>Analyses de rentabilité</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-center">
                            <div class="mb-3">
                                <i class="fas fa-building fa-4x text-primary opacity-75"></i>
                            </div>
                            <div class="d-grid gap-2">
                                <a href="{% url 'proprietes:unites_liste' %}" class="btn btn-primary">
                                    <i class="fas fa-list"></i> Voir les Unités
                                </a>
                                <a href="{% url 'proprietes:unite_create' %}" class="btn btn-outline-primary">
                                    <i class="fas fa-plus"></i> Nouvelle Unité
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Statistiques rapides des unités -->
                    {% if unites_stats %}
                    <hr class="my-4">
                    <div class="row text-center">
                        <div class="col-3">
                            <div class="border-end">
                                <h4 class="text-primary mb-0">{{ unites_stats.total }}</h4>
                                <small class="text-muted">Total Unités</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="border-end">
                                <h4 class="text-success mb-0">{{ unites_stats.disponibles }}</h4>
                                <small class="text-muted">Disponibles</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <div class="border-end">
                                <h4 class="text-danger mb-0">{{ unites_stats.occupees }}</h4>
                                <small class="text-muted">Occupées</small>
                            </div>
                        </div>
                        <div class="col-3">
                            <h4 class="text-warning mb-0">{{ unites_stats.reservees }}</h4>
                            <small class="text-muted">Réservées</small>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Contenu principal -->
    <div class="row">
        <!-- Top propriétés -->
        <div class="col-lg-6">
            <div class="card" role="region" aria-labelledby="top-proprietes-heading">
                <div class="card-header">
                    <h6 id="top-proprietes-heading">
                        <i class="bi bi-star me-2" aria-hidden="true"></i> Top 5 des Propriétés
                    </h6>
                </div>
                <div class="card-body">
                    {% if top_proprietes %}
                        <div class="list-group list-group-flush">
                            {% for propriete in top_proprietes %}
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">{{ propriete.titre }}</h6>
                                    <small class="text-muted">{{ propriete.ville }}</small>
                                </div>
                                <span class="badge bg-primary">
                                    {{ propriete.get_loyer_actuel_calcule }} F CFA
                                </span>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted text-center">Aucune propriété enregistrée</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Statistiques par ville -->
        <div class="col-lg-6">
            <div class="card" role="region" aria-labelledby="proprietes-ville-heading">
                <div class="card-header">
                    <h6 id="proprietes-ville-heading">
                        <i class="bi bi-geo-alt me-2" aria-hidden="true"></i> Propriétés par Ville
                    </h6>
                </div>
                <div class="card-body">
                    {% if proprietes_par_ville %}
                        <div class="list-group list-group-flush">
                            {% for ville in proprietes_par_ville %}
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <span class="h6 mb-0">{{ ville.ville|default:"Ville non renseignée" }}</span>
                                <span class="badge bg-success">{{ ville.count }}</span>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted text-center">Aucune donnée disponible</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Actions rapides -->
    <div class="row">
        <div class="col-12">
            <div class="card" role="region" aria-labelledby="actions-rapides-heading">
                <div class="card-header">
                    <h6 id="actions-rapides-heading">
                        <i class="bi bi-lightning me-2" aria-hidden="true"></i> Actions Rapides
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'proprietes:ajouter' %}" class="btn btn-primary w-100" aria-label="Ajouter une propriété">
                                <i class="bi bi-plus-circle me-2" aria-hidden="true"></i> Ajouter une Propriété
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'core:intelligent_search' %}" class="btn btn-primary w-100" aria-label="Recherche intelligente">
                                <i class="bi bi-search me-2" aria-hidden="true"></i> Recherche Intelligente
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="/admin/" class="btn btn-warning w-100" aria-label="Administration">
                                <i class="bi bi-gear me-2" aria-hidden="true"></i> Administration
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'utilisateurs:profile' %}" class="btn btn-success w-100" aria-label="Mon profil">
                                <i class="bi bi-person me-2" aria-hidden="true"></i> Mon Profil
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'paiements:tableau_bord_dashboard' %}" class="btn btn-info w-100" aria-label="Tableaux de bord">
                                <i class="bi bi-graph-up me-2" aria-hidden="true"></i> Tableaux de Bord
                            </a>
                        </div>
                        <div class="col-md-3 mb-3">
                            <a href="{% url 'core:configuration_entreprise_admin' %}" class="btn btn-warning w-100" aria-label="Configuration admin">
                                <i class="bi bi-cog me-2" aria-hidden="true"></i> Configuration Admin
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboards Avancés -->
    <div class="row">
        <div class="col-12">
            <div class="card" role="region" aria-labelledby="dashboards-avances-heading">
                <div class="card-header">
                    <h6 id="dashboards-avances-heading">
                        <i class="bi bi-crown me-2" aria-hidden="true"></i> Dashboards Avancés
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'utilisateurs:dashboard_groupe' 'PRIVILEGE' %}" class="btn btn-primary w-100" aria-label="Dashboard privilège">
                                <i class="bi bi-crown me-2" aria-hidden="true"></i> 
                                <strong>Dashboard PRIVILEGE</strong>
                                <br><small class="opacity-75">Accès complet système</small>
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'utilisateurs:dashboard_groupe' 'ADMINISTRATION' %}" class="btn btn-success w-100" aria-label="Dashboard administration">
                                <i class="bi bi-building me-2" aria-hidden="true"></i> 
                                <strong>Dashboard ADMINISTRATION</strong>
                                <br><small class="opacity-75">Gestion immobilière</small>
                            </a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'utilisateurs:dashboard_groupe' 'CONTROLES' %}" class="btn btn-warning w-100" aria-label="Dashboard contrôles">
                                <i class="bi bi-shield-check me-2" aria-hidden="true"></i> Dashboard CONTROLES
                            </a>
                        </div>
                        <div class="col-md-6 mb-3">
                            <a href="{% url 'utilisateurs:dashboard_groupe' 'CAISSE' %}" class="btn btn-primary w-100" aria-label="Dashboard caisse">
                                <i class="bi bi-cash-coin me-2" aria-hidden="true"></i> Dashboard CAISSE
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Gestion Documentaire et Financière -->
    <div class="row">
        <div class="col-12">
            <div class="card" role="region" aria-labelledby="gestion-doc-fin-heading">
                <div class="card-header">
                    <h6 id="gestion-doc-fin-heading">
                        <i class="bi bi-files me-2" aria-hidden="true"></i> Gestion Documentaire et Financière
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'proprietes:document_list' %}" class="btn btn-primary w-100" aria-label="Gestion documentaire">
                                <i class="bi bi-file-earmark-text me-2" aria-hidden="true"></i> 
                                <strong>Documents</strong>
                                <br><small class="opacity-75">Gestion documentaire</small>
                            </a>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'paiements:tableau_bord_list' %}" class="btn btn-success w-100" aria-label="Suivi financier">
                                <i class="bi bi-graph-up me-2" aria-hidden="true"></i> 
                                <strong>Tableaux de Bord</strong>
                                <br><small class="opacity-75">Suivi financier</small>
                            </a>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'proprietes:liste' %}" class="btn btn-primary w-100" aria-label="Gestion immobilière">
                                <i class="bi bi-building me-2" aria-hidden="true"></i> 
                                <strong>Propriétés</strong>
                                <br><small class="opacity-75">Gestion immobilière</small>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{% static 'js/dashboard-realtime.js' %}"></script>
{% endblock %}