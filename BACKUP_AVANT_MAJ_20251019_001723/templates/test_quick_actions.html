{% extends 'base.html' %}
{% load static %}

{% block title %}Test des Actions Rapides - Gestion Immobilière{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title mb-0">
                        <i class="bi bi-bug"></i> Test des Actions Rapides
                    </h4>
                </div>
                <div class="card-body">
                    <p class="text-muted">Cette page permet de tester les différents composants d'actions rapides.</p>
                    
                    <!-- Test des actions rapides contextuelles -->
                    <div class="mb-4">
                        <h5>Actions Rapides Contextuelles</h5>
                        {% include 'includes/contextual_quick_actions.html' %}
                    </div>
                    
                    <!-- Test des actions rapides flottantes -->
                    <div class="mb-4">
                        <h5>Actions Rapides Flottantes</h5>
                        {% include 'includes/floating_quick_actions.html' %}
                    </div>
                    
                    <!-- Test de l'aide -->
                    <div class="mb-4">
                        <h5>Aide des Actions Rapides</h5>
                        {% include 'includes/quick_actions_help.html' %}
                    </div>
                    
                    <!-- Test des raccourcis clavier -->
                    <div class="mb-4">
                        <h5>Test des Raccourcis Clavier</h5>
                        <div class="alert alert-info">
                            <h6>Raccourcis disponibles :</h6>
                            <ul class="mb-0">
                                <li><kbd>Ctrl</kbd> + <kbd>M</kbd> - Modifier</li>
                                <li><kbd>Ctrl</kbd> + <kbd>A</kbd> - Ajouter</li>
                                <li><kbd>Ctrl</kbd> + <kbd>P</kbd> - Paiements</li>
                                <li><kbd>Ctrl</kbd> + <kbd>H</kbd> - Aide</li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Test des actions dynamiques -->
                    <div class="mb-4">
                        <h5>Test des Actions Dynamiques</h5>
                        <div class="d-flex gap-2 mb-3">
                            <button class="btn btn-primary" onclick="addTestAction()">
                                <i class="bi bi-plus"></i> Ajouter Action Test
                            </button>
                            <button class="btn btn-warning" onclick="removeTestAction()">
                                <i class="bi bi-dash"></i> Supprimer Action Test
                            </button>
                        </div>
                        <div id="dynamicActionsContainer"></div>
                    </div>
                    
                    <!-- Informations de debug -->
                    <div class="mt-4">
                        <h5>Informations de Debug</h5>
                        <div class="card bg-light">
                            <div class="card-body">
                                <pre id="debugInfo" class="mb-0"></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Simuler des actions rapides pour le test
const testQuickActions = [
    {
        url: '/proprietes/bailleurs/1/modifier/',
        label: 'Modifier',
        icon: 'pencil',
        style: 'btn-primary'
    },
    {
        url: '/proprietes/ajouter/',
        label: 'Ajouter Propriété',
        icon: 'plus-circle',
        style: 'btn-success'
    },
    {
        url: '/paiements/liste/',
        label: 'Voir Paiements',
        icon: 'cash-coin',
        style: 'btn-info'
    },
    {
        url: '/proprietes/bailleurs/1/proprietes/',
        label: 'Ses Propriétés',
        icon: 'house',
        style: 'btn-outline-primary'
    },
    {
        url: '/contrats/ajouter/?bailleur=1',
        label: 'Nouveau Contrat',
        icon: 'file-contract',
        style: 'btn-outline-success'
    }
];

// Ajouter des actions de test au contexte
document.addEventListener('DOMContentLoaded', function() {
    // Simuler le contexte des actions rapides
    window.quick_actions = testQuickActions;
    
    // Afficher les informations de debug
    updateDebugInfo();
    
    // Tester les raccourcis clavier
    testKeyboardShortcuts();
});

function addTestAction() {
    if (typeof QuickActionsEnhanced !== 'undefined') {
        QuickActionsEnhanced.addAction({
            url: '/test/action/',
            label: 'Action Test',
            icon: 'bug',
            style: 'btn-warning',
            tooltip: 'Action de test ajoutée dynamiquement'
        });
        updateDebugInfo();
    }
}

function removeTestAction() {
    if (typeof QuickActionsEnhanced !== 'undefined') {
        QuickActionsEnhanced.removeAction('Action Test');
        updateDebugInfo();
    }
}

function updateDebugInfo() {
    const debugInfo = document.getElementById('debugInfo');
    if (debugInfo) {
        const info = {
            quickActionsAvailable: typeof QuickActionsEnhanced !== 'undefined',
            quickActionsCount: document.querySelectorAll('.quick-action-btn').length,
            contextualActionsCount: document.querySelectorAll('.contextual-action-btn').length,
            floatingActionsCount: document.querySelectorAll('.floating-action-btn').length,
            helpToggleVisible: document.querySelector('.help-toggle') !== null
        };
        debugInfo.textContent = JSON.stringify(info, null, 2);
    }
}

function testKeyboardShortcuts() {
    let shortcutsTested = 0;
    const shortcuts = ['m', 'a', 'p', 'h'];
    
    shortcuts.forEach(key => {
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === key) {
                shortcutsTested++;
                console.log(`Raccourci Ctrl+${key.toUpperCase()} testé`);
                updateDebugInfo();
            }
        });
    });
}

// Tester les actions rapides toutes les 5 secondes
setInterval(updateDebugInfo, 5000);
</script>
{% endblock %}
