{
  "deployment": {
    "version": "2.0",
    "date": "2025-10-09",
    "description": "Système d'avances intelligentes avec intégration automatique",
    "branch": "modifications-octobre-2025"
  },
  "database": {
    "migrations": [
      "paiements.0011_add_manual_month_selection_fields",
      "paiements.0012_add_paiement_field_to_avance"
    ],
    "backup_required": true,
    "data_correction_required": true
  },
  "new_features": [
    "Intégration automatique des avances dans le système de paiement",
    "Détection intelligente des avances existantes avec prolongation",
    "Sélection manuelle des mois couverts avec suggestions dynamiques",
    "Interface utilisateur améliorée avec messages d'erreur clairs"
  ],
  "critical_fixes": [
    "Logique temporelle corrigée (mois actuel = en cours)",
    "Format des années corrigé (2025 au lieu de 0225)",
    "Statuts cohérents (active par défaut)",
    "Compteurs réalistes (suppression des valeurs négatives)"
  ],
  "new_database_fields": [
    {
      "table": "paiements_avanceloyer",
      "field": "paiement_id",
      "type": "ForeignKey",
      "target": "paiements_paiement",
      "nullable": true,
      "description": "Lien vers le paiement associé"
    },
    {
      "table": "paiements_avanceloyer",
      "field": "mode_selection_mois",
      "type": "VARCHAR(20)",
      "default": "automatique",
      "description": "Mode de sélection des mois (automatique/manuel)"
    },
    {
      "table": "paiements_avanceloyer",
      "field": "mois_couverts_manuels",
      "type": "JSON",
      "default": "[]",
      "description": "Liste des mois sélectionnés manuellement"
    }
  ],
  "urls": {
    "new": [
      "/paiements/avances/ajouter/",
      "/paiements/avances/suggestions-mois-ajax/",
      "/paiements/avances/historique/<int:contrat_id>/"
    ],
    "modified": [
      "/paiements/avances/detail/<int:avance_id>/"
    ]
  },
  "templates": {
    "new": [
      "templates/paiements/avances/creer_avance.html",
      "templates/paiements/avances/historique_contrat.html"
    ],
    "modified": [
      "templates/paiements/avances/detail_avance.html"
    ]
  },
  "static_files": {
    "modified": [
      "static/js/dashboard-dynamic.js"
    ]
  },
  "dependencies": {
    "python": ">=3.8",
    "django": ">=4.2",
    "packages": [
      "django",
      "django-crispy-forms",
      "crispy-bootstrap5",
      "django-filter",
      "django-allauth",
      "reportlab",
      "pillow"
    ]
  },
  "deployment_steps": [
    "1. Sauvegarder la base de données",
    "2. Mettre à jour le code source",
    "3. Installer les dépendances",
    "4. Appliquer les migrations",
    "5. Corriger les données existantes",
    "6. Vérifier l'intégrité",
    "7. Tester les nouvelles fonctionnalités",
    "8. Redémarrer les services"
  ],
  "rollback": {
    "database_restore": "python manage.py loaddata backup_avant_avances_intelligentes.json",
    "code_revert": "git checkout HEAD~1",
    "migration_rollback": "python manage.py migrate paiements 0010"
  },
  "monitoring": {
    "logs": [
      "/var/log/nginx/error.log",
      "/var/log/gunicorn/error.log",
      "logs/django.log"
    ],
    "metrics": [
      "Nombre d'avances créées par jour",
      "Taux d'erreur sur la création d'avances",
      "Temps de réponse des pages d'avances",
      "Utilisation de la mémoire"
    ]
  },
  "testing": {
    "urls_to_test": [
      "http://localhost:8000/paiements/avances/ajouter/",
      "http://localhost:8000/paiements/avances/detail/1/",
      "http://localhost:8000/paiements/avances/historique/1/"
    ],
    "functionality_tests": [
      "Création d'avance avec sélection automatique",
      "Création d'avance avec sélection manuelle",
      "Détection d'avances existantes",
      "Calcul de progression correct",
      "Intégration avec le système de paiement"
    ]
  },
  "production_notes": {
    "important": [
      "Vérifier que toutes les avances existantes sont correctement migrées",
      "S'assurer que les dates sont au format correct (2025 au lieu de 0225)",
      "Tester la création d'avances avec différents contrats",
      "Vérifier que les paiements sont automatiquement créés"
    ],
    "warnings": [
      "Les avances existantes avec des dates incorrectes seront corrigées automatiquement",
      "Les consommations avec des dates incorrectes seront supprimées",
      "Les montants restants seront recalculés pour toutes les avances"
    ]
  }
}
