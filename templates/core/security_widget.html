{% load static %}

<!-- Widget de s√©curit√© convivial -->
<div id="security-widget" class="security-widget">
    <div class="security-status" id="security-status">
        <div class="security-icon">üõ°Ô∏è</div>
        <div class="security-message" id="security-message">
            Chargement du statut de s√©curit√©...
        </div>
        <div class="security-tips" id="security-tips" style="display: none;">
            <!-- Les conseils de s√©curit√© s'afficheront ici -->
        </div>
    </div>
</div>

<style>
.security-widget {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1000;
    max-width: 300px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.security-status {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 1rem;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    cursor: pointer;
}

.security-status:hover {
    transform: translateY(-2px);
    box-shadow: 0 15px 40px rgba(0,0,0,0.3);
}

.security-icon {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    text-align: center;
}

.security-message {
    font-size: 0.9rem;
    line-height: 1.4;
    text-align: center;
    margin-bottom: 0.5rem;
}

.security-tips {
    background: rgba(255,255,255,0.1);
    padding: 0.75rem;
    border-radius: 10px;
    margin-top: 0.5rem;
    font-size: 0.8rem;
    line-height: 1.3;
}

.security-tips ul {
    margin: 0;
    padding-left: 1rem;
}

.security-tips li {
    margin-bottom: 0.25rem;
}

/* Animations */
.security-widget.entering {
    animation: slideInRight 0.5s ease-out;
}

.security-widget.leaving {
    animation: slideOutRight 0.3s ease-in;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

/* Responsive */
@media (max-width: 768px) {
    .security-widget {
        top: 10px;
        right: 10px;
        left: 10px;
        max-width: none;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const securityWidget = document.getElementById('security-widget');
    const securityMessage = document.getElementById('security-message');
    const securityTips = document.getElementById('security-tips');
    
    // Animation d'entr√©e
    securityWidget.classList.add('entering');
    
    // Charger le statut de s√©curit√©
    loadSecurityStatus();
    
    // Actualiser toutes les 30 secondes
    setInterval(loadSecurityStatus, 30000);
    
    // Clic pour afficher/masquer les conseils
    securityWidget.addEventListener('click', function() {
        if (securityTips.style.display === 'none') {
            securityTips.style.display = 'block';
        } else {
            securityTips.style.display = 'none';
        }
    });
    
    function loadSecurityStatus() {
        fetch('/security/user-status/')
            .then(response => response.json())
            .then(data => {
                updateSecurityWidget(data);
            })
            .catch(error => {
                console.error('Erreur de chargement du statut de s√©curit√©:', error);
                securityMessage.textContent = 'Statut de s√©curit√© non disponible';
            });
    }
    
    function updateSecurityWidget(data) {
        // Mettre √† jour le message
        securityMessage.textContent = data.status_message || 'Syst√®me s√©curis√©';
        
        // Mettre √† jour les conseils
        if (data.security_tips && data.security_tips.length > 0) {
            const tipsHtml = '<ul>' + data.security_tips.map(tip => `<li>${tip}</li>`).join('') + '</ul>';
            securityTips.innerHTML = tipsHtml;
        }
        
        // Afficher un avertissement si n√©cessaire
        if (data.show_warning) {
            securityWidget.style.background = 'linear-gradient(135deg, #f39c12, #e67e22)';
            securityMessage.textContent = '‚ö†Ô∏è ' + (data.status_message || 'V√©rifiez votre s√©curit√©');
        } else {
            securityWidget.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
        }
        
        // Afficher le niveau de confiance
        if (data.trust_level) {
            const trustLevels = {
                'NEW_USER': 'üÜï Nouvel utilisateur',
                'REGULAR_USER': 'üë§ Utilisateur r√©gulier',
                'TRUSTED_USER': '‚≠ê Utilisateur de confiance',
                'ADMIN_USER': 'üëë Administrateur'
            };
            
            const trustText = trustLevels[data.trust_level] || 'Utilisateur';
            securityMessage.innerHTML = `${trustText}<br><small>${data.status_message || 'Syst√®me s√©curis√©'}</small>`;
        }
    }
    
    // Masquer automatiquement apr√®s 10 secondes (sauf si avertissement)
    setTimeout(() => {
        if (!securityWidget.querySelector('.security-tips').style.display || 
            securityWidget.querySelector('.security-tips').style.display === 'none') {
            securityWidget.style.opacity = '0.7';
        }
    }, 10000);
    
    // R√©afficher au survol
    securityWidget.addEventListener('mouseenter', function() {
        this.style.opacity = '1';
    });
    
    securityWidget.addEventListener('mouseleave', function() {
        if (!securityTips.style.display || securityTips.style.display === 'none') {
            this.style.opacity = '0.7';
        }
    });
});
</script>
