{% load static %}
<!-- Messages d'erreur explicites -->
<script>
// Am√©liorer les messages d'erreur Django
document.addEventListener('DOMContentLoaded', function() {
    // Remplacer les messages d'erreur g√©n√©riques par des messages explicites
    const errorMessages = {
        'required': 'Ce champ est obligatoire. Veuillez le remplir.',
        'invalid': 'La valeur saisie n\'est pas valide. V√©rifiez le format.',
        'min_length': 'Le texte est trop court. Veuillez saisir au moins {min} caract√®res.',
        'max_length': 'Le texte est trop long. Maximum {max} caract√®res autoris√©s.',
        'invalid_email': 'Adresse email invalide. Format attendu : exemple@domaine.com',
        'invalid_phone': 'Num√©ro de t√©l√©phone invalide. Format attendu : 0123456789',
        'invalid_date': 'Date invalide. Format attendu : JJ/MM/AAAA',
        'invalid_number': 'Nombre invalide. Utilisez le point (.) pour les d√©cimales.',
        'unique': 'Cette valeur existe d√©j√†. Veuillez en choisir une autre.',
        'email_unique': 'Cette adresse email existe d√©j√†. Veuillez en choisir une autre.',
        'phone_unique': 'Ce num√©ro de t√©l√©phone est d√©j√† utilis√©. Veuillez en choisir un autre.',
        'permission_denied': 'Vous n\'avez pas les droits pour effectuer cette action.',
        'retrait_period': 'Les retraits ne peuvent √™tre g√©n√©r√©s que du 25 au 5 du mois suivant.',
        'retrait_duplicate': 'Un retrait existe d√©j√† pour ce bailleur ce mois-ci.',
        'contract_active': 'Ce contrat est d√©j√† actif.',
        'contract_expired': 'Ce contrat a expir√©.',
        'payment_duplicate': 'Ce paiement existe d√©j√†.',
        'insufficient_funds': 'Fonds insuffisants pour cette op√©ration.',
        'network_error': 'Erreur de connexion. V√©rifiez votre connexion internet.',
        'server_error': 'Erreur du serveur. Veuillez r√©essayer plus tard.',
        'validation_error': 'Erreur de validation. V√©rifiez les champs marqu√©s en rouge.',
        'file_too_large': 'Fichier trop volumineux. Taille maximum : {max} MB.',
        'file_type_invalid': 'Type de fichier non autoris√©. Formats accept√©s : {types}',
        'database_error': 'Erreur de base de donn√©es. Contactez l\'administrateur.',
        'timeout': 'Op√©ration trop longue. Veuillez r√©essayer.',
        'not_found': '√âl√©ment introuvable. Il a peut-√™tre √©t√© supprim√©.',
        'access_denied': 'Acc√®s refus√©. V√©rifiez vos permissions.',
        'maintenance': 'Maintenance en cours. Veuillez r√©essayer plus tard.'
    };

    // Fonction pour am√©liorer un message d'erreur
    function improveErrorMessage(element, errorType, details = {}) {
        let message = errorMessages[errorType] || 'Erreur inconnue.';
        
        // Remplacer les placeholders
        Object.keys(details).forEach(key => {
            message = message.replace(`{${key}}`, details[key]);
        });
        
        // Ajouter des conseils sp√©cifiques
        const suggestions = getSuggestions(errorType, element);
        if (suggestions) {
            message += '<br><small class="text-muted">üí° ' + suggestions + '</small>';
        }
        
        return message;
    }

    // Conseils sp√©cifiques par type d'erreur
    function getSuggestions(errorType, element) {
        const suggestions = {
            'required': 'Tous les champs marqu√©s d\'un ast√©risque (*) sont obligatoires.',
            'invalid_email': 'Exemple : jean.dupont@email.com',
            'invalid_phone': 'Exemple : 0123456789 ou +226 12 34 56 78',
            'invalid_date': 'Utilisez le format JJ/MM/AAAA ou cliquez sur le calendrier',
            'invalid_number': 'Exemple : 150000 ou 150000.50',
            'min_length': 'Ajoutez plus de d√©tails pour clarifier l\'information',
            'max_length': 'R√©sumez votre texte en gardant l\'essentiel',
            'unique': 'V√©rifiez la liste existante ou modifiez la valeur',
            'email_unique': 'V√©rifiez la liste des utilisateurs existants ou utilisez une variante de votre email',
            'phone_unique': 'V√©rifiez la liste des utilisateurs existants ou utilisez un autre num√©ro de t√©l√©phone',
            'retrait_period': 'Consultez le calendrier pour voir les p√©riodes autoris√©es',
            'retrait_duplicate': 'V√©rifiez la liste des retraits existants',
            'file_too_large': 'Compressez votre fichier ou choisissez un autre format',
            'file_type_invalid': 'Convertissez votre fichier au format demand√©',
            'network_error': 'V√©rifiez votre connexion et r√©essayez',
            'server_error': 'L\'√©quipe technique a √©t√© notifi√©e. R√©essayez dans quelques minutes'
        };
        
        return suggestions[errorType];
    }

    // Am√©liorer les messages d'erreur existants
    const errorElements = document.querySelectorAll('.invalid-feedback, .errorlist, .alert-danger');
    errorElements.forEach(element => {
        const text = element.textContent.toLowerCase();
        
        if (text.includes('required') || text.includes('obligatoire')) {
            element.innerHTML = improveErrorMessage(element, 'required');
        } else if (text.includes('email') || text.includes('courriel')) {
            // V√©rifier si c'est une erreur d'unicit√© ou de format
            if (text.includes('d√©j√† utilis√©e') || text.includes('existe d√©j√†') || text.includes('unique')) {
                element.innerHTML = improveErrorMessage(element, 'email_unique');
            } else {
                element.innerHTML = improveErrorMessage(element, 'invalid_email');
            }
        } else if (text.includes('t√©l√©phone') || text.includes('phone')) {
            // V√©rifier si c'est une erreur d'unicit√© ou de format
            if (text.includes('d√©j√† utilis√©') || text.includes('existe d√©j√†') || text.includes('unique')) {
                element.innerHTML = improveErrorMessage(element, 'phone_unique');
            } else {
                element.innerHTML = improveErrorMessage(element, 'invalid_phone');
            }
        } else if (text.includes('date')) {
            element.innerHTML = improveErrorMessage(element, 'invalid_date');
        } else if (text.includes('nombre') || text.includes('number')) {
            element.innerHTML = improveErrorMessage(element, 'invalid_number');
        } else if (text.includes('unique') || text.includes('existe d√©j√†')) {
            element.innerHTML = improveErrorMessage(element, 'unique');
        } else if (text.includes('p√©riode') || text.includes('retrait')) {
            element.innerHTML = improveErrorMessage(element, 'retrait_period');
        } else if (text.includes('doublon') || text.includes('duplicate')) {
            element.innerHTML = improveErrorMessage(element, 'retrait_duplicate');
        } else if (text.includes('fichier') || text.includes('file')) {
            if (text.includes('trop gros') || text.includes('too large')) {
                element.innerHTML = improveErrorMessage(element, 'file_too_large', { max: '10' });
            } else if (text.includes('type') || text.includes('format')) {
                element.innerHTML = improveErrorMessage(element, 'file_type_invalid', { types: 'PDF, JPG, PNG' });
            }
        } else if (text.includes('connexion') || text.includes('network')) {
            element.innerHTML = improveErrorMessage(element, 'network_error');
        } else if (text.includes('serveur') || text.includes('server')) {
            element.innerHTML = improveErrorMessage(element, 'server_error');
        } else if (text.includes('permission') || text.includes('acc√®s')) {
            element.innerHTML = improveErrorMessage(element, 'access_denied');
        }
    });

    // Am√©liorer les messages de succ√®s
    const successElements = document.querySelectorAll('.alert-success');
    successElements.forEach(element => {
        const text = element.textContent.toLowerCase();

        // Priorit√© √† la r√©siliation pour √©viter les collisions avec "cr√©√©e"
        if (text.includes('r√©siliation') || text.includes('r√©sili√©')) {
            element.innerHTML = `
                <i class="bi bi-check-circle-fill me-2"></i>
                <strong>R√©siliation effectu√©e avec succ√®s !</strong><br>
                <small>Le contrat est d√©sormais cl√¥tur√©. Vous pouvez g√©rer les d√©penses de sortie et g√©n√©rer le PDF de r√©siliation.</small>
            `;
        } else if (text.includes('paiement') && text.includes('enregistr√©')) {
            element.innerHTML = `
                <i class="bi bi-check-circle-fill me-2"></i>
                <strong>Paiement enregistr√© avec succ√®s !</strong><br>
                <small>Vous pouvez maintenant g√©n√©rer un r√©c√©piss√© ou une quittance. Utilisez les boutons d'action dans la liste.</small>
            `;
        } else if (text.includes('contrat') && /\bcr√©√©(?!e)/.test(text)) {
            element.innerHTML = `
                <i class="bi bi-check-circle-fill me-2"></i>
                <strong>Contrat cr√©√© avec succ√®s !</strong><br>
                <small>Le contrat est maintenant actif. Vous pouvez ajouter des paiements ou g√©n√©rer des quittances.</small>
            `;
        } else if (text.includes('propri√©t√©') && text.includes('ajout√©e')) {
            element.innerHTML = `
                <i class="bi bi-check-circle-fill me-2"></i>
                <strong>Propri√©t√© ajout√©e avec succ√®s !</strong><br>
                <small>Vous pouvez maintenant cr√©er des unit√©s locatives et des contrats pour cette propri√©t√©.</small>
            `;
        } else if (text.includes('bailleur') && text.includes('ajout√©')) {
            element.innerHTML = `
                <i class="bi bi-check-circle-fill me-2"></i>
                <strong>Bailleur ajout√© avec succ√®s !</strong><br>
                <small>Le bailleur peut maintenant √™tre associ√© √† des propri√©t√©s et des contrats.</small>
            `;
        } else if (text.includes('locataire') && text.includes('ajout√©')) {
            element.innerHTML = `
                <i class="bi bi-check-circle-fill me-2"></i>
                <strong>Locataire ajout√© avec succ√®s !</strong><br>
                <small>Le locataire peut maintenant √™tre associ√© √† des contrats et des paiements.</small>
            `;
        }
    });

    // Am√©liorer les messages d'information
    const infoElements = document.querySelectorAll('.alert-info');
    infoElements.forEach(element => {
        const text = element.textContent.toLowerCase();
        
        if (text.includes('recherche')) {
            element.innerHTML = `
                <i class="bi bi-info-circle-fill me-2"></i>
                <strong>Astuce de recherche</strong><br>
                <small>Utilisez Ctrl+K pour rechercher rapidement. Vous pouvez chercher par nom, t√©l√©phone, ou adresse.</small>
            `;
        } else if (text.includes('raccourci') || text.includes('shortcut')) {
            element.innerHTML = `
                <i class="bi bi-keyboard-fill me-2"></i>
                <strong>Raccourcis clavier disponibles</strong><br>
                <small>Ctrl+P: Propri√©t√©s | Ctrl+C: Contrats | Ctrl+M: Paiements | Ctrl+B: Bailleurs | Ctrl+L: Locataires</small>
            `;
        }
    });
});
</script>
