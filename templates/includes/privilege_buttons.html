{% load core_extras %}
{% comment %}
Template pour afficher les boutons de privil√®ge (modifier, supprimer, d√©sactiver)
pour les utilisateurs du groupe PRIVILEGE dans les listes d'√©l√©ments.
{% endcomment %}

{% if is_privilege_user and privilege_actions and privilege_actions|get_item:object.id %}
    <div class="privilege-actions-container" data-object-id="{{ object.id }}">
        <div class="btn-group privilege-btn-group" role="group" aria-label="Actions de privil√®ge">
            {% for action in privilege_actions|get_item:object.id %}
                {% if action.type == 'edit' %}
                    <!-- Bouton Modifier -->
                    <a href="{{ action.url }}" 
                       class="btn btn-sm btn-{{ action.style }} {{ action.class }}"
                       title="{{ action.title }}"
                       data-bs-toggle="tooltip"
                       data-bs-placement="top">
                        <i class="bi bi-{{ action.icon }}"></i>
                        <span class="d-none d-sm-inline">Modifier</span>
                    </a>
                
                {% elif action.type == 'delete' %}
                    <!-- Bouton Supprimer -->
                    <button type="button"
                            class="btn btn-sm btn-{{ action.style }} {{ action.class }}"
                            title="{{ action.title }}"
                            data-bs-toggle="tooltip"
                            data-bs-placement="top"
                            data-object-id="{{ action.data.object_id }}"
                            data-object-name="{{ action.data.object_name }}"
                            data-model-name="{{ action.data.model_name }}"
                            data-can-delete="{{ action.data.can_delete }}"
                            onclick="confirmPrivilegeDelete(this)">
                        <i class="bi bi-{{ action.icon }}"></i>
                        <span class="d-none d-sm-inline">Supprimer</span>
                    </button>
                
                {% elif action.type == 'disable' %}
                    <!-- Bouton D√©sactiver -->
                    <button type="button"
                            class="btn btn-sm btn-{{ action.style }} {{ action.class }}"
                            title="{{ action.title }}"
                            data-bs-toggle="tooltip"
                            data-bs-placement="top"
                            data-object-id="{{ action.data.object_id }}"
                            data-object-name="{{ action.data.object_name }}"
                            data-model-name="{{ action.data.model_name }}"
                            data-can-delete="{{ action.data.can_delete }}"
                            {% if action.data.reason %}data-reason="{{ action.data.reason }}"{% endif %}
                            onclick="confirmPrivilegeDisable(this)">
                        <i class="bi bi-{{ action.icon }}"></i>
                        <span class="d-none d-sm-inline">D√©sactiver</span>
                    </button>
                
                {% elif action.type == 'force_delete' %}
                    <!-- Bouton Suppression Forc√©e/Urgente -->
                    <button type="button"
                            class="btn btn-sm btn-{{ action.style }} {{ action.class }}"
                            title="{{ action.title }}"
                            data-bs-toggle="tooltip"
                            data-bs-placement="top"
                            data-object-id="{{ action.data.object_id }}"
                            data-object-name="{{ action.data.object_name }}"
                            data-model-name="{{ action.data.model_name }}"
                            data-can-force-delete="{{ action.data.can_force_delete }}"
                            data-contracts-count="{{ action.data.contracts_count }}"
                            data-force-delete-message="{{ action.data.force_delete_message }}"
                            onclick="confirmForceDelete(this)">
                        <i class="bi bi-{{ action.icon }}"></i>
                        <span class="d-none d-sm-inline">Suppression Forc√©e</span>
                        <!-- Debug temporaire -->
                        <small class="d-block text-muted" style="font-size: 0.7em;">
                            Debug: can={{ action.data.can_force_delete }}, count={{ action.data.contracts_count }}
                        </small>
                    </button>
                {% endif %}
            {% endfor %}
        </div>
        
        <!-- Indicateur de statut PRIVILEGE -->
        <div class="privilege-status-indicator">
            <small class="text-muted">
                <i class="bi bi-shield-check text-success"></i>
                Actions PRIVILEGE
            </small>
        </div>
    </div>
{% endif %}

<style>
.privilege-actions-container {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
}

.privilege-btn-group {
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border-radius: 6px;
    overflow: hidden;
}

.privilege-btn-group .btn {
    border: none;
    transition: all 0.2s ease;
    font-size: 0.8rem;
    padding: 0.375rem 0.75rem;
}

.privilege-btn-group .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}

.btn-edit-privilege:hover {
    background-color: #ffc107 !important;
    border-color: #ffc107 !important;
    color: #000 !important;
}

.btn-delete-privilege:hover {
    background-color: #dc3545 !important;
    border-color: #dc3545 !important;
    color: #fff !important;
}

.btn-disable-privilege:hover {
    background-color: #6c757d !important;
    border-color: #6c757d !important;
    color: #fff !important;
}

.btn-force-delete-privilege {
    background-color: #dc3545 !important;
    border-color: #dc3545 !important;
    color: #fff !important;
    font-weight: bold;
    animation: pulse-danger 2s infinite;
}

.btn-force-delete-privilege:hover {
    background-color: #c82333 !important;
    border-color: #bd2130 !important;
    color: #fff !important;
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(220, 53, 69, 0.4);
}

@keyframes pulse-danger {
    0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
    100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
}

.privilege-status-indicator {
    font-size: 0.7rem;
    opacity: 0.7;
}

.privilege-status-indicator .bi-shield-check {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

/* Responsive */
@media (max-width: 768px) {
    .privilege-btn-group .btn span {
        display: none !important;
    }
    
    .privilege-btn-group .btn {
        padding: 0.375rem;
        min-width: 32px;
    }
    
    .privilege-status-indicator {
        display: none;
    }
}
</style>

<script>
// Fonction pour confirmer la suppression d'un √©l√©ment
function confirmPrivilegeDelete(button) {
    const objectId = button.dataset.objectId;
    const objectName = button.dataset.objectName;
    const modelName = button.dataset.modelName;
    const canDelete = button.dataset.canDelete === 'true';
    
    if (!canDelete) {
        showPrivilegeAlert('warning', 'Suppression impossible', 
            'Cet √©l√©ment ne peut pas √™tre supprim√© car il est r√©f√©renc√© ailleurs.');
        return;
    }
    
    const confirmMessage = `√ätes-vous s√ªr de vouloir supprimer d√©finitivement "${objectName}" ?\n\nCette action est irr√©versible et sera trac√©e dans l'audit.`;
    
    if (confirm(confirmMessage)) {
        performPrivilegeAction('delete', objectId, modelName, objectName);
    }
}

// Fonction pour confirmer la d√©sactivation d'un √©l√©ment
function confirmPrivilegeDisable(button) {
    const objectId = button.dataset.objectId;
    const objectName = button.dataset.objectName;
    const modelName = button.dataset.modelName;
    const reason = button.dataset.reason || 'r√©f√©renc√© ailleurs';
    
    const confirmMessage = `√ätes-vous s√ªr de vouloir d√©sactiver "${objectName}" ?\n\nRaison: ${reason}\n\nCette action sera trac√©e dans l'audit.`;
    
    if (confirm(confirmMessage)) {
        performPrivilegeAction('disable', objectId, modelName, objectName);
    }
}

// Fonction pour confirmer la suppression forc√©e d'un √©l√©ment
function confirmForceDelete(button) {
    const objectId = button.dataset.objectId;
    const objectName = button.dataset.objectName;
    const modelName = button.dataset.modelName;
    const canForceDelete = button.dataset.canForceDelete === 'true';
    const contractsCount = parseInt(button.dataset.contractsCount) || 0;
    const forceDeleteMessage = button.dataset.forceDeleteMessage || '';
    
    // Debug temporaire
    console.log('üîç Debug suppression forc√©e:', {
        objectId,
        objectName,
        modelName,
        canForceDelete,
        contractsCount,
        forceDeleteMessage: forceDeleteMessage.substring(0, 100) + '...'
    });
    
    // Debug des attributs du bouton
    console.log('üîç Attributs du bouton:', {
        'data-can-force-delete': button.dataset.canForceDelete,
        'data-contracts-count': button.dataset.contractsCount,
        'data-force-delete-message': button.dataset.forceDeleteMessage
    });
    
    if (!canForceDelete) {
        console.log('‚ùå Suppression impossible - contrats actifs d√©tect√©s');
        // Afficher un message d'erreur d√©taill√© avec actions concr√®tes
        showForceDeleteErrorWithActions(forceDeleteMessage, objectId, modelName, objectName);
        return;
    }
    
    console.log('‚úÖ Suppression autoris√©e - affichage de la modal de confirmation');
    // Afficher une modal de confirmation pour la suppression autoris√©e
    showForceDeleteConfirmationModal(objectId, modelName, objectName);
}

// Fonction pour afficher la modal de confirmation de suppression forc√©e
function showForceDeleteConfirmationModal(objectId, modelName, objectName) {
    const modalHtml = `
        <div class="modal fade" id="forceDeleteConfirmationModal" tabindex="-1" aria-labelledby="forceDeleteConfirmationModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title" id="forceDeleteConfirmationModalLabel">
                            <i class="bi bi-check-circle-fill"></i>
                            ‚úÖ SUPPRESSION FORC√âE AUTORIS√âE
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-success" role="alert">
                            <h6 class="alert-heading">‚úÖ V√©rification effectu√©e</h6>
                            <p class="mb-0">L'√©l√©ment <strong>"${objectName}"</strong> peut √™tre supprim√© car il n'est li√© √† aucun contrat actif.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h6>üìã D√©tails de la suppression :</h6>
                            <div class="bg-light p-3 rounded">
                                <ul class="mb-0 small">
                                    <li><strong>Type :</strong> Suppression physique d√©finitive</li>
                                    <li><strong>√âl√©ment :</strong> ${objectName}</li>
                                    <li><strong>Mod√®le :</strong> ${modelName}</li>
                                    <li><strong>Contrats actifs :</strong> Aucun d√©tect√©</li>
                                    <li><strong>R√©cup√©ration :</strong> Impossible apr√®s suppression</li>
                                    <li><strong>Audit :</strong> Action trac√©e dans les logs</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="alert alert-warning" role="alert">
                            <h6 class="alert-heading">‚ö†Ô∏è ATTENTION - ACTION IRR√âVERSIBLE</h6>
                            <p class="mb-0">Cette suppression est <strong>D√âFINITIVE</strong> et ne peut pas √™tre annul√©e. L'√©l√©ment sera perdu √† jamais.</p>
                        </div>
                        
                        <div class="mb-3">
                            <label for="confirmationInput" class="form-label">
                                <strong>üîê Confirmation requise :</strong><br>
                                Tapez exactement <code>SUPPRIMER</code> pour confirmer la suppression physique :
                            </label>
                            <input type="text" class="form-control" id="confirmationInput" placeholder="Tapez SUPPRIMER ici...">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle"></i> Annuler
                        </button>
                        <button type="button" class="btn btn-danger" id="confirmForceDeleteBtn" disabled>
                            <i class="bi bi-exclamation-triangle-fill"></i> Confirmer la suppression
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Supprimer l'ancienne modal si elle existe
    const existingModal = document.getElementById('forceDeleteConfirmationModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Ajouter la nouvelle modal au DOM
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Afficher la modal
    const modal = new bootstrap.Modal(document.getElementById('forceDeleteConfirmationModal'));
    modal.show();
    
    // G√©rer la validation de l'input
    const confirmationInput = document.getElementById('confirmationInput');
    const confirmBtn = document.getElementById('confirmForceDeleteBtn');
    
    confirmationInput.addEventListener('input', function() {
        if (this.value === 'SUPPRIMER') {
            confirmBtn.disabled = false;
            confirmBtn.classList.remove('btn-secondary');
            confirmBtn.classList.add('btn-danger');
        } else {
            confirmBtn.disabled = true;
            confirmBtn.classList.remove('btn-danger');
            confirmBtn.classList.add('btn-secondary');
        }
    });
    
    // G√©rer la confirmation
    confirmBtn.addEventListener('click', function() {
        if (confirmationInput.value === 'SUPPRIMER') {
            modal.hide();
            performForceDeleteAction('force_delete', objectId, modelName, objectName);
        }
    });
    
    // G√©rer la touche Entr√©e
    confirmationInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && this.value === 'SUPPRIMER') {
            confirmBtn.click();
        }
    });
}

// Fonction pour effectuer l'action de privil√®ge
function performPrivilegeAction(actionType, objectId, modelName, objectName) {
    const button = document.querySelector(`[data-object-id="${objectId}"][data-model-name="${modelName}"]`);
    const originalContent = button.innerHTML;
    
    // Afficher un indicateur de chargement
    button.innerHTML = '<i class="bi bi-hourglass-split"></i> <span class="d-none d-sm-inline">En cours...</span>';
    button.disabled = true;
    
    // Construire l'URL de l'action
    let actionUrl;
    if (actionType === 'delete') {
        actionUrl = `/utilisateurs/privilege/delete/${modelName}/${objectId}/`;
    } else if (actionType === 'disable') {
        actionUrl = `/utilisateurs/privilege/disable/${modelName}/${objectId}/`;
    }
    
    // Effectuer la requ√™te AJAX
    fetch(actionUrl, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            action: actionType,
            object_id: objectId,
            model_name: modelName
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showPrivilegeAlert('success', 'Action r√©ussie', data.message);
            
            // Si c'est une suppression, masquer la ligne
            if (actionType === 'delete') {
                const row = button.closest('tr');
                row.style.opacity = '0.5';
                row.style.backgroundColor = '#f8f9fa';
                setTimeout(() => {
                    row.remove();
                }, 1000);
            }
            
            // Si c'est une d√©sactivation, mettre √† jour l'interface
            if (actionType === 'disable') {
                const row = button.closest('tr');
                row.style.opacity = '0.7';
                row.style.backgroundColor = '#f8f9fa';
                
                // Remplacer le bouton d√©sactiver par un indicateur
                const actionsContainer = button.closest('.privilege-actions-container');
                actionsContainer.innerHTML = `
                    <div class="text-muted">
                        <i class="bi bi-pause-circle-fill text-secondary"></i>
                        <small>D√©sactiv√©</small>
                    </div>
                `;
            }
        } else {
            showPrivilegeAlert('error', 'Erreur', data.message);
            // Restaurer le bouton
            button.innerHTML = originalContent;
            button.disabled = false;
        }
    })
    .catch(error => {
        console.error('Erreur lors de l\'action de privil√®ge:', error);
        showPrivilegeAlert('error', 'Erreur', 'Une erreur est survenue lors de l\'ex√©cution de l\'action.');
        // Restaurer le bouton
        button.innerHTML = originalContent;
        button.disabled = false;
    });
}

// Fonction pour effectuer la suppression forc√©e
function performForceDeleteAction(actionType, objectId, modelName, objectName) {
    const button = document.querySelector(`[data-object-id="${objectId}"][data-model-name="${modelName}"]`);
    const originalContent = button.innerHTML;
    
    // Afficher un indicateur de chargement sp√©cial pour la suppression forc√©e
    button.innerHTML = '<i class="bi bi-exclamation-triangle-fill"></i> <span class="d-none d-sm-inline">Suppression...</span>';
    button.disabled = true;
    button.classList.add('btn-warning');
    
    // Construire l'URL de l'action de suppression forc√©e
    const actionUrl = `/utilisateurs/privilege/force_delete/${modelName}/${objectId}/`;
    
    // Effectuer la requ√™te AJAX
    fetch(actionUrl, {
        method: 'POST',
        headers: {
            'X-CSRFToken': getCookie('csrftoken'),
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            action: actionType,
            object_id: objectId,
            model_name: modelName,
            force_delete: true
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showPrivilegeAlert('success', '‚úÖ SUPPRESSION FORC√âE R√âUSSIE', 
                `L'√©l√©ment "${objectName}" a √©t√© supprim√© d√©finitivement de la base de donn√©es.\n\n` +
                `üìã D√©tails :\n‚Ä¢ Action : Suppression forc√©e/urgente\n‚Ä¢ Utilisateur : ${data.user || 'N/A'}\n‚Ä¢ Heure : ${new Date().toLocaleString()}\n‚Ä¢ Audit : Action trac√©e dans les logs`);
            
            // Masquer la ligne avec animation sp√©ciale
            const row = button.closest('tr');
            row.style.transition = 'all 0.5s ease';
            row.style.opacity = '0.3';
            row.style.backgroundColor = '#ffebee';
            row.style.borderLeft = '4px solid #dc3545';
            
            setTimeout(() => {
                row.remove();
            }, 1500);
            
        } else {
            showPrivilegeAlert('error', '‚ùå ERREUR DE SUPPRESSION FORC√âE', 
                `Impossible de supprimer l'√©l√©ment "${objectName}".\n\n` +
                `üìã D√©tails de l'erreur :\n${data.message}\n\n` +
                `üí° Solutions possibles :\n‚Ä¢ V√©rifiez les permissions\n‚Ä¢ R√©siliez les contrats actifs\n‚Ä¢ Contactez l'administrateur`);
            // Restaurer le bouton
            button.innerHTML = originalContent;
            button.disabled = false;
            button.classList.remove('btn-warning');
        }
    })
    .catch(error => {
        console.error('Erreur lors de la suppression forc√©e:', error);
        showPrivilegeAlert('error', '‚ùå ERREUR SYST√àME', 
            `Une erreur technique est survenue lors de la suppression forc√©e.\n\n` +
            `üìã D√©tails :\n‚Ä¢ √âl√©ment : "${objectName}"\n‚Ä¢ Erreur : ${error.message}\n‚Ä¢ Heure : ${new Date().toLocaleString()}\n\n` +
            `üí° Solution :\nContactez l'administrateur syst√®me.`);
        // Restaurer le bouton
        button.innerHTML = originalContent;
        button.disabled = false;
        button.classList.remove('btn-warning');
    });
}

// Fonction pour afficher l'erreur de suppression forc√©e avec actions concr√®tes
function showForceDeleteErrorWithActions(message, objectId, modelName, objectName) {
    // Cr√©er une modal Bootstrap pour afficher l'erreur avec actions
    const modalHtml = `
        <div class="modal fade" id="forceDeleteErrorModal" tabindex="-1" aria-labelledby="forceDeleteErrorModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-warning text-dark">
                        <h5 class="modal-title" id="forceDeleteErrorModalLabel">
                            <i class="bi bi-exclamation-triangle-fill"></i>
                            üö´ SUPPRESSION FORC√âE IMPOSSIBLE
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert alert-warning" role="alert">
                            <h6 class="alert-heading">‚ö†Ô∏è Action requise avant suppression</h6>
                            <p class="mb-0">L'√©l√©ment <strong>"${objectName}"</strong> ne peut pas √™tre supprim√© car il est li√© √† des contrats actifs.</p>
                        </div>
                        
                        <div class="mb-3">
                            <h6>üìã D√©tails de l'erreur :</h6>
                            <pre class="bg-light p-3 rounded" style="white-space: pre-wrap; font-size: 0.9em;">${message}</pre>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card border-primary">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0"><i class="bi bi-list-check"></i> Actions disponibles</h6>
                                    </div>
                                    <div class="card-body">
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-outline-primary" onclick="openContratsList()">
                                                <i class="bi bi-list-ul"></i> Voir tous les contrats
                                            </button>
                                            <button class="btn btn-outline-warning" onclick="openContratsActifs()">
                                                <i class="bi bi-exclamation-circle"></i> Voir les contrats actifs
                                            </button>
                                            <button class="btn btn-outline-info" onclick="openContratsByElement('${modelName}', ${objectId})">
                                                <i class="bi bi-search"></i> Contrats de cet √©l√©ment
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-success">
                                    <div class="card-header bg-success text-white">
                                        <h6 class="mb-0"><i class="bi bi-lightbulb"></i> Solutions</h6>
                                    </div>
                                    <div class="card-body">
                                        <ol class="mb-0 small">
                                            <li>Cliquez sur "Voir les contrats actifs"</li>
                                            <li>Identifiez les contrats li√©s √† cet √©l√©ment</li>
                                            <li>R√©siliez chaque contrat un par un</li>
                                            <li>Revenez ici pour la suppression</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle"></i> Fermer
                        </button>
                        <button type="button" class="btn btn-primary" onclick="retryForceDelete('${objectId}', '${modelName}', '${objectName}')">
                            <i class="bi bi-arrow-clockwise"></i> V√©rifier √† nouveau
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Supprimer l'ancienne modal si elle existe
    const existingModal = document.getElementById('forceDeleteErrorModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Ajouter la nouvelle modal au DOM
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Afficher la modal
    const modal = new bootstrap.Modal(document.getElementById('forceDeleteErrorModal'));
    modal.show();
}

// Fonctions d'action pour la modal d'erreur
function openContratsList() {
    window.open('/contrats/liste/', '_blank');
}

function openContratsActifs() {
    window.open('/contrats/liste/?filter=actifs', '_blank');
}

function openContratsByElement(modelName, objectId) {
    let url = '/contrats/liste/';
    if (modelName === 'propriete') {
        url += `?propriete=${objectId}`;
    } else if (modelName === 'locataire') {
        url += `?locataire=${objectId}`;
    } else if (modelName === 'bailleur') {
        url += `?bailleur=${objectId}`;
    }
    window.open(url, '_blank');
}

function retryForceDelete(objectId, modelName, objectName) {
    // Fermer la modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('forceDeleteErrorModal'));
    modal.hide();
    
    // Relancer la v√©rification
    setTimeout(() => {
        const button = document.querySelector(`[data-object-id="${objectId}"][data-model-name="${modelName}"]`);
        if (button) {
            confirmForceDelete(button);
        }
    }, 500);
}

// Fonction pour afficher les alertes de privil√®ge
function showPrivilegeAlert(type, title, message) {
    const alertClass = type === 'success' ? 'alert-success' : 
                      type === 'warning' ? 'alert-warning' : 'alert-danger';
    
    const alertHtml = `
        <div class="alert ${alertClass} alert-dismissible fade show privilege-alert" role="alert">
            <strong>${title}:</strong> ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    `;
    
    // Cr√©er l'alerte
    const alertElement = document.createElement('div');
    alertElement.innerHTML = alertHtml;
    const alert = alertElement.firstElementChild;
    
    // Ajouter l'alerte en haut de la page
    const container = document.querySelector('.intelligent-list-container') || document.body;
    container.insertBefore(alert, container.firstChild);
    
    // Auto-fermeture apr√®s 5 secondes
    setTimeout(() => {
        if (alert.parentNode) {
            alert.remove();
        }
    }, 5000);
}

// Fonction pour r√©cup√©rer le cookie CSRF
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Initialiser les tooltips Bootstrap
document.addEventListener('DOMContentLoaded', function() {
    if (typeof bootstrap !== 'undefined') {
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    }
});
</script>
