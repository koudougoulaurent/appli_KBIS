{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
    .form-section {
        background-color: #f8f9fa;
        border-radius: 0.375rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    .section-title {
        color: #495057;
        border-bottom: 2px solid #007bff;
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
    }
    .required-field::after {
        content: " *";
        color: #dc3545;
    }
    .info-box {
        background-color: #e7f3ff;
        border: 1px solid #b3d9ff;
        border-radius: 0.375rem;
        padding: 1rem;
        margin-bottom: 1rem;
    }
</style>
{% endblock %}

{% block content %}
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title mb-0">
                        <i class="bi bi-plus-circle"></i> {{ title }}
                    </h4>
                </div>
                
                <div class="card-body">
                    <div class="info-box">
                        <h6><i class="bi bi-info-circle"></i> À propos des charges déductibles</h6>
                        <p class="mb-0 small">
                            Les charges déductibles sont des frais avancés par le locataire qui doivent normalement être 
                            supportés par le bailleur. Une fois validées, elles seront automatiquement déduites 
                            lors des prochains paiements de loyer.
                        </p>
                    </div>
                    
                    <form method="post" id="charge-form">
                        {% csrf_token %}
                        
                        <!-- Informations de base -->
                        <div class="form-section">
                            <h5 class="section-title">
                                <i class="bi bi-file-text"></i> Informations de base
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.contrat.id_for_label }}" class="form-label required-field">
                                            {{ form.contrat.label }}
                                        </label>
                                        {{ form.contrat }}
                                        {% if form.contrat.errors %}
                                            <div class="text-danger small">{{ form.contrat.errors }}</div>
                                        {% endif %}
                                        <div class="form-text">Sélectionnez le contrat concerné par cette charge</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.type_charge.id_for_label }}" class="form-label required-field">
                                            {{ form.type_charge.label }}
                                        </label>
                                        {{ form.type_charge }}
                                        {% if form.type_charge.errors %}
                                            <div class="text-danger small">{{ form.type_charge.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="mb-3">
                                        <label for="{{ form.libelle.id_for_label }}" class="form-label required-field">
                                            {{ form.libelle.label }}
                                        </label>
                                        {{ form.libelle }}
                                        {% if form.libelle.errors %}
                                            <div class="text-danger small">{{ form.libelle.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="mb-3">
                                        <label for="{{ form.montant.id_for_label }}" class="form-label required-field">
                                            {{ form.montant.label }}
                                        </label>
                                        <div class="input-group">
                                            {{ form.montant }}
                                            <span class="input-group-text" style="background-color: #e9ecef; color: #495057; font-weight: bold; border: 2px solid #007bff;">F CFA</span>
                                        </div>

                                        {% if form.montant.errors %}
                                            <div class="text-danger small">{{ form.montant.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.date_charge.id_for_label }}" class="form-label required-field">
                                    {{ form.date_charge.label }}
                                </label>
                                {{ form.date_charge }}
                                {% if form.date_charge.errors %}
                                    <div class="text-danger small">{{ form.date_charge.errors }}</div>
                                {% endif %}
                                <div class="form-text">Date à laquelle la charge a été engagée</div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.description.id_for_label }}" class="form-label">
                                    {{ form.description.label }}
                                </label>
                                {{ form.description }}
                                {% if form.description.errors %}
                                    <div class="text-danger small">{{ form.description.errors }}</div>
                                {% endif %}
                                <div class="form-text">Description détaillée de la charge et des travaux effectués</div>
                            </div>
                        </div>
                        
                        <!-- Informations du fournisseur -->
                        <div class="form-section">
                            <h5 class="section-title">
                                <i class="bi bi-building"></i> Informations du fournisseur
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.fournisseur.id_for_label }}" class="form-label">
                                            {{ form.fournisseur.label }}
                                        </label>
                                        {{ form.fournisseur }}
                                        {% if form.fournisseur.errors %}
                                            <div class="text-danger small">{{ form.fournisseur.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="{{ form.facture_numero.id_for_label }}" class="form-label">
                                            {{ form.facture_numero.label }}
                                        </label>
                                        {{ form.facture_numero }}
                                        {% if form.facture_numero.errors %}
                                            <div class="text-danger small">{{ form.facture_numero.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.justificatif_url.id_for_label }}" class="form-label">
                                    {{ form.justificatif_url.label }}
                                </label>
                                {{ form.justificatif_url }}
                                {% if form.justificatif_url.errors %}
                                    <div class="text-danger small">{{ form.justificatif_url.errors }}</div>
                                {% endif %}
                                <div class="form-text">
                                    URL vers un justificatif numérique (photo de facture, devis, etc.)
                                </div>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="d-flex justify-content-between">
                            <div>
                                <a href="{% url 'paiements:charges_deductibles_liste' %}" class="btn btn-outline-secondary">
                                    <i class="bi bi-arrow-left"></i> Retour à la liste
                                </a>
                            </div>
                            <div>
                                <button type="button" class="btn btn-outline-warning me-2" onclick="resetForm()">
                                    <i class="bi bi-arrow-clockwise"></i> Réinitialiser
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-check-circle"></i> Enregistrer la charge
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function resetForm() {
    if (confirm('Êtes-vous sûr de vouloir réinitialiser le formulaire ? Toutes les données saisies seront perdues.')) {
        document.getElementById('charge-form').reset();
    }
}

// Auto-focus sur le premier champ
document.addEventListener('DOMContentLoaded', function() {
    const firstInput = document.querySelector('form input, form select');
    if (firstInput) {
        firstInput.focus();
    }
});
</script>
{% endblock %}