{% extends 'base_dashboard.html' %}
{% load static %}
{% load humanize %}

{% block title %}Quittance de paiement - {{ quittance.numero_quittance }}{% endblock %}

{% block extra_css %}
<style>
    /* Styles pour l'impression A4 - Format optimisé */
    @media print {
        @page {
            size: A4;
            margin: 15mm;
        }
        
        .no-print {
            display: none !important;
        }
        
        /* Supprimer l'URL et les éléments de navigation du navigateur */
        @page {
            @bottom-right {
                content: none;
            }
        }
        
        body {
            font-size: 12px;
            line-height: 1.4;
            margin: 0;
            padding: 0;
        }
        
        .quittance-page {
            width: 100%;
            height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .quittance-container {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            box-shadow: none;
            border: none;
            display: flex;
            flex-direction: column;
        }
        
        /* En-tête entreprise - optimisé A4 */
        .entreprise-header {
            padding: 8mm;
            margin-bottom: 4mm;
        }
        
        .entreprise-nom {
            font-size: 18px;
            margin-bottom: 2mm;
        }
        
        .entreprise-details {
            font-size: 11px;
            line-height: 1.2;
        }
        
        /* En-tête quittance - optimisé A4 */
        .quittance-header {
            padding: 6mm;
            margin-bottom: 4mm;
        }
        
        .quittance-title {
            font-size: 20px;
            margin-bottom: 2mm;
        }
        
        .quittance-number {
            font-size: 14px;
        }
        
        .quittance-date {
            font-size: 11px;
        }
        
        /* Sections - optimisées A4 */
        .quittance-section {
            padding: 4mm 6mm;
            margin-bottom: 3mm;
        }
        
        .section-header h5 {
            font-size: 12px;
            margin-bottom: 2mm;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3mm;
        }
        
        .info-label {
            font-size: 9px;
        }
        
        .info-value {
            font-size: 11px;
            padding: 2mm;
        }
        
        /* Détails paiement - optimisés A4 */
        .payment-details {
            padding: 4mm 6mm;
            margin-bottom: 3mm;
        }
        
        .payment-details h5 {
            font-size: 12px;
            margin-bottom: 2mm;
        }
        
        .payment-info {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 3mm;
        }
        
        .payment-info-item {
            font-size: 10px;
            padding: 1mm 0;
        }
        
        /* Montant - mis en évidence */
        .amount-section {
            margin: 4mm 6mm;
            padding: 6mm;
        }
        
        .amount-value {
            font-size: 24px;
        }
        
        .amount-label {
            font-size: 12px;
        }
        
        /* Pied de page - compact */
        .quittance-footer {
            padding: 2mm 3mm;
            margin-top: auto;
        }
        
        .signature-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3mm;
            margin-bottom: 2mm;
        }
        
        .signature-box {
            padding: 2mm;
        }
        
        .signature-line {
            height: 15px;
            margin: 2mm 0;
        }
        
        .signature-label {
            font-size: 6px;
        }
        
        .entreprise-footer {
            padding: 2mm;
        }
        
        .entreprise-footer-info {
            font-size: 6px;
            line-height: 1.0;
        }
    }

    /* Styles pour l'écran - Format A4 optimisé */
    .quittance-page {
        background: #f8f9fa;
        min-height: 100vh;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .quittance-container {
        width: 210mm;
        height: 297mm;
        margin: 0;
        background: white;
        border: 1px solid #ddd;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
    }

    /* En-tête de l'entreprise - Style humain */
    .entreprise-header {
        background: white;
        color: #2c3e50;
        padding: 15mm 20mm 10mm 20mm;
        text-align: left;
        border-bottom: 1px solid #ddd;
        flex-shrink: 0;
    }

    .entreprise-logo {
        margin-bottom: 8mm;
        text-align: left;
    }

    .entreprise-logo img {
        max-height: 50px;
        max-width: 150px;
        object-fit: contain;
    }

    .entreprise-nom {
        font-size: 24px;
        font-weight: 600;
        margin-bottom: 4mm;
        color: #2c3e50;
        font-family: 'Times New Roman', serif;
    }

    .entreprise-details {
        font-size: 11px;
        color: #666;
        line-height: 1.4;
        font-family: Arial, sans-serif;
    }

    /* En-tête de la quittance - Style humain */
    .quittance-header {
        background: white;
        padding: 15mm 20mm 10mm 20mm;
        text-align: center;
        border-bottom: 1px solid #ddd;
        flex-shrink: 0;
    }

    .quittance-title {
        font-size: 20px;
        font-weight: 600;
        margin: 0 0 8mm 0;
        color: #2c3e50;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: 'Times New Roman', serif;
    }

    .quittance-number {
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 4mm;
        color: #333;
        font-family: Arial, sans-serif;
    }

    .quittance-date {
        color: #666;
        font-size: 11px;
        margin: 0;
        font-family: Arial, sans-serif;
    }

    /* Sections de la quittance - Style humain */
    .quittance-section {
        padding: 10mm 20mm;
        border-bottom: 1px solid #ddd;
        flex-shrink: 0;
    }

    .quittance-section:last-child {
        border-bottom: none;
    }

    .section-header {
        margin-bottom: 6mm;
        color: #2c3e50;
    }

    .section-header i {
        display: none;
    }

    .section-header h5 {
        margin: 0;
        font-weight: 600;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: #333;
        font-family: Arial, sans-serif;
        border-bottom: 1px solid #ccc;
        padding-bottom: 2mm;
    }

    .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8mm;
    }

    .info-item {
        display: flex;
        flex-direction: column;
    }

    .info-label {
        font-size: 10px;
        color: #666;
        font-weight: 500;
        margin-bottom: 3mm;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-family: Arial, sans-serif;
    }

    .info-value {
        font-size: 12px;
        color: #333;
        font-weight: 500;
        padding: 0;
        background: none;
        border: none;
        border-bottom: 1px solid #ddd;
        padding-bottom: 2mm;
        font-family: Arial, sans-serif;
    }

    /* Section des montants - Style humain */
    .amount-section {
        background: white;
        color: #333;
        padding: 15mm 20mm;
        text-align: center;
        margin: 0;
        border: 2px solid #333;
        flex-shrink: 0;
    }

    .amount-value {
        font-size: 28px;
        font-weight: 700;
        margin-bottom: 4mm;
        font-family: 'Times New Roman', serif;
    }

    .amount-label {
        font-size: 12px;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: Arial, sans-serif;
    }

    /* Détails du paiement - Style humain */
    .payment-details {
        background: white;
        padding: 10mm 20mm;
        border-bottom: 1px solid #ddd;
        flex-shrink: 0;
    }

    .payment-details h5 {
        font-size: 12px;
        margin: 0 0 6mm 0;
        color: #333;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-family: Arial, sans-serif;
        border-bottom: 1px solid #ccc;
        padding-bottom: 2mm;
    }

    .payment-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8mm;
        font-size: 11px;
    }

    .payment-info-item {
        display: flex;
        justify-content: space-between;
        padding: 3mm 0;
        border-bottom: 1px solid #eee;
    }

    .payment-info-label {
        color: #666;
        font-weight: 500;
        font-family: Arial, sans-serif;
    }

    .payment-info-value {
        color: #333;
        font-weight: 500;
        font-family: Arial, sans-serif;
    }

    /* Pied de page avec signatures et entreprise - Style humain */
    .quittance-footer {
        background: white;
        padding: 15mm 20mm;
        border-top: 1px solid #ddd;
        margin-top: auto;
        flex-shrink: 0;
    }

    .signature-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20mm;
        margin-bottom: 15mm;
    }

    .signature-box {
        text-align: center;
        padding: 0;
        background: none;
        border: none;
    }

    .signature-line {
        width: 100%;
        height: 1px;
        background: #333;
        margin: 8mm 0 4mm 0;
    }

    .signature-label {
        margin: 0;
        color: #666;
        font-size: 10px;
        font-weight: 500;
        font-family: Arial, sans-serif;
    }

    .entreprise-footer {
        background: white;
        color: #666;
        padding: 0;
        text-align: center;
        border-top: 1px solid #ddd;
        padding-top: 8mm;
    }

    .entreprise-footer-info {
        font-size: 10px;
        line-height: 1.4;
        font-family: Arial, sans-serif;
    }


    /* Responsive pour format A4 */
    @media (max-width: 768px) {
        .quittance-page {
            padding: 0.5rem 0;
        }
        
        .quittance-container {
            width: 100%;
            height: auto;
            margin: 0.5rem;
            border-radius: 0;
        }
        
        .info-grid {
            grid-template-columns: 1fr;
        }
        
        .payment-info {
            grid-template-columns: 1fr 1fr;
        }
        
        .signature-section {
            grid-template-columns: 1fr;
            gap: 4mm;
        }
    }
    
    /* Ajustements pour très petits écrans */
    @media (max-width: 480px) {
        .quittance-container {
            margin: 0.25rem;
        }
        
        .entreprise-header {
            padding: 6mm;
        }
        
        .quittance-header {
            padding: 4mm;
        }
        
        .quittance-section {
            padding: 4mm 6mm;
        }
        
        .payment-details {
            padding: 4mm 6mm;
        }
        
        .quittance-footer {
            padding: 4mm 6mm;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="quittance-page">
    <!-- Contenu de la quittance -->
    <div class="quittance-container">
            <!-- En-tête de l'entreprise -->
            <div class="entreprise-header">
                {% if config_entreprise.logo_url %}
                <div class="entreprise-logo">
                    <img src="{{ config_entreprise.logo_url }}" alt="Logo" onerror="this.style.display='none'">
                </div>
                {% endif %}
                <div class="entreprise-nom">{{ config_entreprise.nom_entreprise|default:"Configuration non trouvée" }}</div>
                <div class="entreprise-details">
                    {{ config_entreprise.get_adresse_complete|default:"Adresse non configurée" }}<br>
                    {{ config_entreprise.get_contact_complet|default:"Contact non configuré" }}
                </div>
            </div>

            <!-- En-tête de la quittance -->
            <div class="quittance-header">
                <h1 class="quittance-title">Quittance de Paiement</h1>
                <div class="quittance-number">N° {{ quittance.numero_quittance }}</div>
                <p class="quittance-date">Émise le {{ quittance.date_emission|date:"d/m/Y à H:i" }}</p>
            </div>

            <!-- Informations du locataire et propriété -->
            <div class="quittance-section">
                <div class="section-header">
                    <h5>Locataire & Propriété</h5>
                </div>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Locataire</span>
                        <span class="info-value">{{ quittance.get_locataire.get_nom_complet }} ({{ quittance.get_locataire.code_locataire }})</span>
                    </div>
                    {% with prop=quittance.get_propriete %}
                    <div class="info-item">
                        <span class="info-label">Propriété</span>
                        <span class="info-value">{{ prop.numero_propriete|default:"-" }} - {{ prop.titre|default:"-" }}</span>
                    </div>
                    {% endwith %}
                    {% if quittance.get_unite_locative %}
                        {% with unite=quittance.get_unite_locative %}
                        <div class="info-item">
                            <span class="info-label">Unité</span>
                            <span class="info-value">{{ unite.nom|default:"-" }} ({{ unite.type_unite|default:"-" }})</span>
                        </div>
                        {% endwith %}
                    {% endif %}
                    <div class="info-item">
                        <span class="info-label">Contrat</span>
                        <span class="info-value">N° {{ quittance.paiement.contrat.numero_contrat }}</span>
                    </div>
                </div>
            </div>

            <!-- Détails du paiement -->
            <div class="payment-details">
                <h5>Détails du paiement</h5>
                <div class="payment-info">
                    <div class="payment-info-item">
                        <span class="payment-info-label">Type:</span>
                        <span class="payment-info-value">{{ quittance.paiement.get_type_paiement_display }}</span>
                    </div>
                    <div class="payment-info-item">
                        <span class="payment-info-label">Mode:</span>
                        <span class="payment-info-value">{{ quittance.paiement.get_mode_paiement_display }}</span>
                    </div>
                    <div class="payment-info-item">
                        <span class="payment-info-label">Date:</span>
                        <span class="payment-info-value">{{ quittance.paiement.date_paiement|date:"d/m/Y" }}</span>
                    </div>
                    <div class="payment-info-item">
                        <span class="payment-info-label">Période:</span>
                        <span class="payment-info-value">{{ quittance.paiement.periode|default:quittance.paiement.date_paiement|date:"F Y" }}</span>
                    </div>
                </div>
            </div>

            <!-- Montant principal -->
            <div class="amount-section">
                <div class="amount-value">{{ quittance.paiement.get_montant_formatted }}</div>
                <div class="amount-label">Montant total payé</div>
            </div>

            <!-- Pied de page avec signatures et entreprise -->
            <div class="quittance-footer">
                <div class="signature-section">
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <p class="signature-label">Signature du Gérant</p>
                    </div>
                    <div class="signature-box">
                        <div class="signature-line"></div>
                        <p class="signature-label">Signature du locataire</p>
                    </div>
                </div>

                <div class="entreprise-footer">
                    <div class="entreprise-footer-info">
                        <strong>{{ config_entreprise.nom_entreprise|default:"Configuration non trouvée" }}</strong><br>
                        {{ config_entreprise.get_adresse_complete|default:"Adresse non configurée" }}<br>
                        {{ config_entreprise.get_contact_complet|default:"Contact non configuré" }}
                        {% if config_entreprise.get_informations_legales %}
                        <br>{{ config_entreprise.get_informations_legales }}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Script pour améliorer l'expérience utilisateur
    document.addEventListener('DOMContentLoaded', function() {
        // Animation d'apparition des sections
        const sections = document.querySelectorAll('.quittance-section');
        sections.forEach((section, index) => {
            section.style.opacity = '0';
            section.style.transform = 'translateY(20px)';
            section.style.transition = 'all 0.5s ease';
            
            setTimeout(() => {
                section.style.opacity = '1';
                section.style.transform = 'translateY(0)';
            }, index * 100);
        });

        // Animation de l'en-tête
        const header = document.querySelector('.quittance-header');
        header.style.opacity = '0';
        header.style.transform = 'scale(0.9)';
        header.style.transition = 'all 0.8s ease';
        
        setTimeout(() => {
            header.style.opacity = '1';
            header.style.transform = 'scale(1)';
        }, 200);
    });
</script>
{% endblock %}
