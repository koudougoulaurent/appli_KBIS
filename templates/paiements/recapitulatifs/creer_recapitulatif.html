{% extends 'base_dashboard.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}{{ page_title }} - Gestion Immobili√®re{% endblock %}

{% block extra_css %}
<style>
    .period-info {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem;
        border-radius: 10px;
        margin-bottom: 1.5rem;
    }
    
    .period-info h5 {
        margin-bottom: 0.5rem;
        font-weight: 600;
    }
    
    .period-info p {
        margin-bottom: 0;
        opacity: 0.9;
    }
    
    .form-section {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
    }
    
    .form-section h6 {
        color: #2c3e50;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid #ecf0f1;
    }
    
    .type-explanation {
        background: #f8f9fa;
        border-left: 4px solid #007bff;
        padding: 1rem;
        margin-top: 1rem;
        border-radius: 0 5px 5px 0;
    }
    
    .type-explanation h6 {
        color: #007bff;
        margin-bottom: 0.5rem;
    }
    
    .type-explanation ul {
        margin-bottom: 0;
        padding-left: 1.5rem;
    }
    
    .type-explanation li {
        margin-bottom: 0.25rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">
        <i class="bi bi-{{ page_icon }} text-primary"></i>
        {{ page_title }}
    </h1>
    <div class="btn-group" role="group">
        <a href="{% url 'paiements:liste_recapitulatifs' %}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Retour √† la liste
        </a>
    </div>
</div>

<!-- Information sur la p√©riode -->
<div class="period-info" id="periodInfo">
    <h5><i class="bi bi-calendar3"></i> S√©lection de la p√©riode</h5>
    <p id="periodDescription">Choisissez le type de r√©capitulatif et la p√©riode de r√©f√©rence pour g√©n√©rer automatiquement les calculs.</p>
</div>

<!-- Formulaire principal -->
<div class="form-section">
    <h6><i class="bi bi-file-earmark-text"></i> Informations du r√©capitulatif</h6>
    
    <form method="post" id="recapitulatifForm">
        {% csrf_token %}
        
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    {{ form.bailleur|as_crispy_field }}
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-3">
                    {{ form.mois_recap|as_crispy_field }}
                </div>
            </div>
        </div>
        
        <!-- Explication du type s√©lectionn√© -->
        <div class="type-explanation" id="typeExplanation" style="display: none;">
            <h6 id="typeTitle">Type de r√©capitulatif</h6>
            <ul id="typeDetails">
                <!-- Contenu dynamique -->
            </ul>
        </div>
        
        <div class="d-flex justify-content-between mt-4">
            <a href="{% url 'paiements:liste_recapitulatifs' %}" class="btn btn-secondary">
                <i class="bi bi-x-circle"></i> Annuler
            </a>
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-check-circle"></i> Cr√©er le r√©capitulatif
            </button>
        </div>
    </form>
</div>

<!-- Aide contextuelle -->
<div class="form-section">
    <h6><i class="bi bi-info-circle"></i> Aide</h6>
    <div class="row">
        <div class="col-md-6">
            <h6 class="text-primary">R√©capitulatif mensuel</h6>
            <ul class="list-unstyled">
                <li><strong>üìÖ P√©riode :</strong> 1 mois complet</li>
                <li><strong>üìä Calculs :</strong> Automatiques</li>
                <li><strong>üìà Contenu :</strong> Loyers et charges</li>
                <li><strong>‚ö° Usage :</strong> Suivi mensuel standard</li>
            </ul>
        </div>
        <div class="col-md-6">
            <h6 class="text-success">Calculs automatiques</h6>
            <ul class="list-unstyled">
                <li>‚Ä¢ Loyers bruts du mois</li>
                <li>‚Ä¢ Charges d√©ductibles du mois</li>
                <li>‚Ä¢ Charges bailleur du mois</li>
                <li>‚Ä¢ Montant net √† payer</li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const periodInfo = document.getElementById('periodInfo');
    const periodDescription = document.getElementById('periodDescription');
    const typeExplanation = document.getElementById('typeExplanation');
    const typeTitle = document.getElementById('typeTitle');
    const typeDetails = document.getElementById('typeDetails');
    
    // Mettre √† jour la description
    periodDescription.textContent = 'S√©lectionnez un bailleur et le mois de r√©f√©rence pour cr√©er le r√©capitulatif mensuel.';
    
    // Validation du formulaire
    document.getElementById('recapitulatifForm').addEventListener('submit', function(e) {
        const bailleur = document.getElementById('id_bailleur').value;
        const mois = document.getElementById('id_mois_recap').value;
        
        if (!bailleur || !mois) {
            e.preventDefault();
            alert('Veuillez remplir tous les champs obligatoires.');
            return false;
        }
        
        // Confirmation avec d√©tails
        const confirmation = confirm(
            `Confirmer la cr√©ation du r√©capitulatif mensuel ?\n\n` +
            `Mois de r√©f√©rence : ${mois}\n\n` +
            `Le r√©capitulatif sera cr√©√© pour le mois s√©lectionn√©.`
        );
        
        if (!confirmation) {
            e.preventDefault();
            return false;
        }
    });
});
</script>
{% endblock %}