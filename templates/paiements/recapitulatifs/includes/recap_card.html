<div class="card recap-card {{ recapitulatif.statut }}">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-start mb-2">
            <h6 class="card-title mb-0">
                {% if recapitulatif.bailleur %}
                    {{ recapitulatif.bailleur.get_nom_complet }}
                {% else %}
                    Récapitulatif
                {% endif %}
            </h6>
            <span class="badge bg-{{ recapitulatif.get_statut_display_color }}">
                {{ recapitulatif.get_statut_display }}
            </span>
        </div>
        
        <p class="card-text text-muted mb-2">
            <i class="bi bi-calendar"></i>
            {{ recapitulatif.mois_recap|date:"F Y" }}
        </p>
        
        {% if recapitulatif.bailleur %}
        <p class="card-text small mb-2">
            <i class="bi bi-person"></i>
            {{ recapitulatif.bailleur.get_nom_complet }}
        </p>
        {% endif %}
        
        <p class="card-text small text-muted mb-3">
            <i class="bi bi-clock"></i>
            Créé le {{ recapitulatif.date_creation|date:"d/m/Y H:i"|default:"N/A" }}
        </p>
        
        <div class="action-buttons">
            <a href="{% url 'paiements:detail_recapitulatif' recapitulatif.pk %}" 
               class="btn btn-sm btn-outline-primary">
                <i class="bi bi-eye"></i> Voir
            </a>
            
            <!-- Barre déroulante d'actions -->
            <div class="btn-group">
                <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-gear"></i> Actions
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                        <a class="dropdown-item" href="{% url 'paiements:detail_recapitulatif' recapitulatif.pk %}">
                            <i class="bi bi-eye text-primary"></i> Voir le détail
                        </a>
                    </li>
                    
                    <li>
                        <a class="dropdown-item" href="{% url 'paiements:apercu_recapitulatif' recapitulatif.pk %}" target="_blank">
                            <i class="bi bi-eye text-info"></i> Aperçu
                        </a>
                    </li>
                    
                    <li>
                        <a class="dropdown-item" href="{% url 'paiements:telecharger_pdf_recapitulatif' recapitulatif.pk %}">
                            <i class="bi bi-download text-success"></i> Télécharger PDF
                        </a>
                    </li>
                    
                    {% if recapitulatif.bailleur %}
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item" href="{% url 'paiements:generer_recap_paiement_mensuel' recapitulatif.bailleur.pk %}?mois={{ recapitulatif.mois_recap|date:'Y-m' }}" 
                           target="_blank">
                            <i class="bi bi-cash-stack text-info"></i> État de paiement mensuel
                        </a>
                    </li>
                    {% endif %}
                    
                    {% if recapitulatif.statut == 'brouillon' %}
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item" href="{% url 'paiements:valider_recapitulatif' recapitulatif.pk %}" 
                           onclick="return confirm('Êtes-vous sûr de vouloir valider ce récapitulatif ?');">
                            <i class="bi bi-check-circle text-success"></i> Valider
                        </a>
                    </li>
                    {% endif %}
                    
                    {% if recapitulatif.statut == 'valide' %}
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item" href="{% url 'paiements:envoyer_recapitulatif' recapitulatif.pk %}" 
                           onclick="return confirm('Marquer ce récapitulatif comme envoyé ?');">
                            <i class="bi bi-send text-info"></i> Marquer comme envoyé
                        </a>
                    </li>
                    {% endif %}
                    
                    {% if recapitulatif.statut == 'envoye' %}
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item" href="{% url 'paiements:marquer_paye_recapitulatif' recapitulatif.pk %}" 
                           onclick="return confirm('Marquer ce récapitulatif comme payé ?');">
                            <i class="bi bi-cash text-warning"></i> Marquer comme payé
                        </a>
                    </li>
                    {% endif %}
                    
                    {% if is_privilege_user %}
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item text-danger" href="{% url 'paiements:supprimer_recap_mensuel' recapitulatif.pk %}">
                            <i class="bi bi-trash"></i> Supprimer
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </div>
</div>

