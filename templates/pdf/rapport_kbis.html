{% extends 'pdf/base_document_kbis.html' %}

{% load static %}


{% block extra_css %}
{% include "includes/recu_header.html" %}
{% endblock %}
{% block title %}{{ rapport.titre|default:"Rapport" }} - KBIS{% endblock %}

{% block content %}
<div class="document-title">
    <h1>{{ rapport.titre|default:"RAPPORT"|upper }}</h1>
    <p>Période : {{ rapport.date_debut|date:"d/m/Y" }} - {{ rapport.date_fin|date:"d/m/Y" }}</p>
</div>

<div class="info-section">
    <h3>Informations du Rapport</h3>
    <div class="info-row">
        <span class="info-label">Type :</span>
        <span class="info-value">{{ rapport.type_rapport|default:"Général" }}</span>
    </div>
    <div class="info-row">
        <span class="info-label">Période :</span>
        <span class="info-value">Du {{ rapport.date_debut|date:"d/m/Y" }} au {{ rapport.date_fin|date:"d/m/Y" }}</span>
    </div>
    <div class="info-row">
        <span class="info-label">Généré le :</span>
        <span class="info-value">{{ rapport.date_creation|date:"d/m/Y à H:i" }}</span>
    </div>
    {% if rapport.generateur %}
    <div class="info-row">
        <span class="info-label">Généré par :</span>
        <span class="info-value">{{ rapport.generateur }}</span>
    </div>
    {% endif %}
</div>

{% if rapport.resume %}
<div class="info-section">
    <h3>Résumé Exécutif</h3>
    <p>{{ rapport.resume|linebreaks }}</p>
</div>
{% endif %}

{% if rapport.statistiques %}
<div class="info-section">
    <h3>Statistiques</h3>
    <table class="document-table">
        <thead>
            <tr>
                <th>Indicateur</th>
                <th>Valeur</th>
                <th>Évolution</th>
            </tr>
        </thead>
        <tbody>
            {% for stat in rapport.statistiques %}
            <tr>
                <td>{{ stat.nom }}</td>
                <td>{{ stat.valeur }}</td>
                <td>
                    {% if stat.evolution > 0 %}
                        <span style="color: green;">+{{ stat.evolution }}%</span>
                    {% elif stat.evolution < 0 %}
                        <span style="color: red;">{{ stat.evolution }}%</span>
                    {% else %}
                        <span style="color: gray;">0%</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% if rapport.donnees %}
<div class="info-section">
    <h3>Données Détaillées</h3>
    <table class="document-table">
        <thead>
            <tr>
                {% for colonne in rapport.colonnes %}
                <th>{{ colonne }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for ligne in rapport.donnees %}
            <tr>
                {% for cellule in ligne %}
                <td>{{ cellule }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% if rapport.graphiques %}
<div class="info-section">
    <h3>Graphiques</h3>
    {% for graphique in rapport.graphiques %}
    <div style="margin: 20px 0; text-align: center;">
        <h4>{{ graphique.titre }}</h4>
        {% if graphique.image %}
        <img src="{{ graphique.image.url }}" alt="{{ graphique.titre }}" style="max-width: 100%; height: auto;">
        {% else %}
        <p style="color: #6b7280; font-style: italic;">Graphique non disponible</p>
        {% endif %}
    </div>
    {% endfor %}
</div>
{% endif %}

{% if rapport.analyses %}
<div class="info-section">
    <h3>Analyses</h3>
    {% for analyse in rapport.analyses %}
    <div style="margin: 15px 0; padding: 10px; background: #f8fafc; border-radius: 5px;">
        <h4 style="color: #1e3c72; margin-bottom: 8px;">{{ analyse.titre }}</h4>
        <p>{{ analyse.contenu|linebreaks }}</p>
    </div>
    {% endfor %}
</div>
{% endif %}

{% if rapport.recommandations %}
<div class="info-section">
    <h3>Recommandations</h3>
    <ol style="margin-left: 20px;">
        {% for recommandation in rapport.recommandations %}
        <li style="margin: 8px 0;">{{ recommandation }}</li>
        {% endfor %}
    </ol>
</div>
{% endif %}

{% if rapport.conclusion %}
<div class="info-section">
    <h3>Conclusion</h3>
    <p>{{ rapport.conclusion|linebreaks }}</p>
</div>
{% endif %}

<div class="info-section">
    <h3>Annexes</h3>
    <p>Ce rapport a été généré automatiquement par le système de gestion KBIS Immobilier & Construction.</p>
    <p>Pour toute question ou clarification, veuillez contacter notre équipe.</p>
</div>
{% endblock %}
